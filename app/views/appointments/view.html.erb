<% # Adds a stylesheet link in <head> # %>
<% content_for :header_include do %>
    <%= stylesheet_link_tag "calendar" %>
<% end %>

<% # Adds js link and code to footer of <body> # %>
<% content_for :footer_include do %>
    <%= javascript_include_tag "calendar" %>

    <script type="text/javascript">
      (function($) {

        "use strict";

        var options = {

          <% # add calendar data via JSON to JS view %>
          events_source: <%= @cal_data.to_json.html_safe %>,
          view: 'month',
          tmpl_path: '/tmpls/',
          tmpl_cache: false,

          <% # set the calendar to point to today's date (on first load only) %>
          day: '<%= Time.now.strftime("%Y-%m-%d") %>',
          onAfterEventsLoad: function(events) {
            if(!events) {
              return;
            }
            var list = $('#eventlist');
            list.html('');

            $.each(events, function(key, val) {
              $(document.createElement('li'))
                  .html('<a href="' + val.url + '">' + val.title + '</a>')
                  .appendTo(list);
            });
          },
          onAfterViewLoad: function(view) {
            $('.page-header h3').text(this.getTitle());
            $('.btn-group button').removeClass('active');
            $('button[data-calendar-view="' + view + '"]').addClass('active');
          },
          classes: {
            months: {
              general: 'label'
            }
          }
        };

        var calendar = $('#calendar').calendar(options);

        $('.btn-group button[data-calendar-nav]').each(function() {
          var $this = $(this);
          $this.click(function() {
            calendar.navigate($this.data('calendar-nav'));
          });
        });

        $('.btn-group button[data-calendar-view]').each(function() {
          var $this = $(this);
          $this.click(function() {
            calendar.view($this.data('calendar-view'));
          });
        });

        $('#first_day').change(function(){
          var value = $(this).val();
          value = value.length ? parseInt(value) : null;
          calendar.setOptions({first_day: value});
          calendar.view();
        });

        $('#language').change(function(){
          calendar.setLanguage($(this).val());
          calendar.view();
        });

        $('#events-in-modal').change(function(){
          var val = $(this).is(':checked') ? $(this).val() : null;
          calendar.setOptions({modal: val});
        });
        $('#format-12-hours').change(function(){
          var val = $(this).is(':checked') ? true : false;
          calendar.setOptions({format12: val});
          calendar.view();
        });
        $('#show_wbn').change(function(){
          var val = $(this).is(':checked') ? true : false;
          calendar.setOptions({display_week_numbers: val});
          calendar.view();
        });
        $('#show_wb').change(function(){
          var val = $(this).is(':checked') ? true : false;
          calendar.setOptions({weekbox: val});
          calendar.view();
        });
        $('#events-modal .modal-header, #events-modal .modal-footer').click(function(e){
          //e.preventDefault();
          //e.stopPropagation();
        });
      }(jQuery));
    </script>

<% end %>

<% # Actual View Contents # %>
<div class="page-header">

  <div class="pull-right form-inline">
    <div class="btn-group">
      <button class="btn btn-primary" data-calendar-nav="prev"><< Prev</button>
      <button class="btn btn-default" data-calendar-nav="today">Today</button>
      <button class="btn btn-primary" data-calendar-nav="next">Next >></button>
    </div>
    <div class="btn-group">
      <button class="btn btn-warning" data-calendar-view="year">Year</button>
      <button class="btn btn-warning active" data-calendar-view="month">Month</button>
      <button class="btn btn-warning" data-calendar-view="week">Week</button>
      <button class="btn btn-warning" data-calendar-view="day">Day</button>
    </div>
  </div>

  <h3></h3>
  <small>To see example with events navigate to march 2013</small>
</div>

<div class="row">
  <div class="col-md-9">
    <div id="calendar"></div>
  </div>
  <div class="col-md-3">
    <div class="row">
      <select id="first_day" class="form-control">
        <option value="" selected="selected">First day of week language-dependant</option>
        <option value="2">First day of week is Sunday</option>
        <option value="1">First day of week is Monday</option>
      </select>
      <select id="language" class="form-control">
        <option value="">Select Language (default: en-US)</option>
        <option value="bg-BG">Bulgarian</option>
        <option value="nl-NL">Dutch</option>
        <option value="fr-FR">French</option>
        <option value="de-DE">German</option>
        <option value="el-GR">Greek</option>
        <option value="hu-HU">Hungarian</option>
        <option value="id-ID">Bahasa Indonesia</option>
        <option value="it-IT">Italian</option>
        <option value="pl-PL">Polish</option>
        <option value="pt-BR">Portuguese (Brazil)</option>
        <option value="ro-RO">Romania</option>
        <option value="es-CO">Spanish (Colombia)</option>
        <option value="es-MX">Spanish (Mexico)</option>
        <option value="es-ES">Spanish (Spain)</option>
        <option value="ru-RU">Russian</option>
        <option value="sk-SR">Slovak</option>
        <option value="sv-SE">Swedish</option>
        <option value="ko-KR">Korean</option>
        <option value="zh-TW">繁體中文</option>
        <option value="th-TH">Thai (Thailand)</option>
      </select>
      <label class="checkbox">
        <input type="checkbox" value="#events-modal" id="events-in-modal"> Open events in modal window
      </label>
      <label class="checkbox">
        <input type="checkbox" id="format-12-hours"> 12 Hour format
      </label>
      <label class="checkbox">
        <input type="checkbox" id="show_wb" checked> Show week box
      </label>
      <label class="checkbox">
        <input type="checkbox" id="show_wbn" checked> Show week box number
      </label>
    </div>

    <h4>Events</h4>
    <small>This list is populated with events dynamically</small>
    <ul id="eventlist" class="nav nav-list"></ul>
  </div>
</div>


